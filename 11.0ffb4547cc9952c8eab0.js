(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{Smg6:function(t,e,n){"use strict";n.r(e),n.d(e,"StudentsModule",(function(){return R}));var i=n("ofXK"),s=n("tyNb"),a=n("lJxs"),o=n("fXoL"),c=n("lV75"),r=n("x6JD"),b=n("tk/3");let l=(()=>{class t{constructor(t){this.http=t}get url(){return c.a.baseUrl}getStudents(t){let e=this.url+"student";return t&&(e+=r.a.getOptionsQuery(t)),this.http.get(e)}updateStudent(t,e,n){let i=`${this.url}student/${t}`;return n&&(i+=r.a.getOptionsQuery(n)),this.http.put(i,e)}}return t.\u0275fac=function(e){return new(e||t)(o.Ub(b.b))},t.\u0275prov=o.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var d=n("0IaG"),u=n("3Pt+"),p=n("SxV6"),h=n("quSY"),m=n("9nlD"),g=n("VuJc"),f=n("kmnG"),P=n("qFsG"),v=n("1jcm"),Q=n("d3UM"),x=n("FKr1");function y(t,e){if(1&t&&(o.Qb(0,"mat-option",20),o.Ac(1),o.Pb()),2&t){const t=e.$implicit;o.hc("value",t.id),o.zb(1),o.Cc(" ",t.name," ")}}function S(t,e){if(1&t){const t=o.Rb();o.Qb(0,"h6",45),o.Ac(1,"Details "),o.Qb(2,"img",46),o.Xb("click",(function(){return o.pc(t),o.bc(2).enableExtend=!1})),o.Pb(),o.Pb()}}function w(t,e){1&t&&(o.Qb(0,"div",48),o.Ac(1,"* Required "),o.Pb())}function A(t,e){if(1&t&&(o.Qb(0,"div"),o.yc(1,w,2,0,"div",47),o.Pb()),2&t){const t=o.bc(2);o.zb(1),o.hc("ngIf",t.extendSubmitted&&t.e.notes.errors.required)}}function _(t,e){1&t&&(o.Qb(0,"div",49),o.Mb(1,"img",50),o.Pb())}function C(t,e){if(1&t){const t=o.Rb();o.Qb(0,"div",21),o.yc(1,S,3,0,"h6",22),o.Qb(2,"div",23),o.Qb(3,"form",24),o.Xb("ngSubmit",(function(){return o.pc(t),o.bc().confirmExtend()})),o.Qb(4,"div",25),o.Qb(5,"div",26),o.Qb(6,"div",27),o.Qb(7,"label",28),o.Ac(8," Extend for "),o.Pb(),o.Qb(9,"select",29),o.Qb(10,"option",30),o.Ac(11,"1 Day"),o.Pb(),o.Qb(12,"option",31),o.Ac(13,"2 Days"),o.Pb(),o.Qb(14,"option",32),o.Ac(15,"3 Days"),o.Pb(),o.Qb(16,"option",33),o.Ac(17,"5 Days"),o.Pb(),o.Qb(18,"option",34),o.Ac(19,"1 Week"),o.Pb(),o.Qb(20,"option",35),o.Ac(21,"10 Days"),o.Pb(),o.Qb(22,"option",36),o.Ac(23,"2 Weeks"),o.Pb(),o.Qb(24,"option",37),o.Ac(25,"1 Month"),o.Pb(),o.Pb(),o.Pb(),o.Pb(),o.Qb(26,"div",38),o.Qb(27,"div",27),o.Qb(28,"div",39),o.Qb(29,"label",40),o.Ac(30," Notes "),o.Pb(),o.yc(31,A,2,1,"div",19),o.Pb(),o.Mb(32,"textarea",41),o.Pb(),o.Qb(33,"div",42),o.Qb(34,"button",43),o.yc(35,_,2,0,"div",44),o.Ac(36," Confirm "),o.Pb(),o.Pb(),o.Pb(),o.Pb(),o.Pb(),o.Pb(),o.Pb()}if(2&t){const t=o.bc();o.zb(1),o.hc("ngIf",t.enableExtend),o.zb(2),o.hc("formGroup",t.extensionForm),o.zb(28),o.hc("ngIf",t.extendSubmitted&&t.e.notes.errors),o.zb(3),o.hc("disabled",t.extendSubscLoader),o.zb(1),o.hc("ngIf",t.extendSubscLoader)}}function z(t,e){1&t&&(o.Qb(0,"p",0),o.Ac(1,"EMPTY"),o.Pb())}function O(t,e){if(1&t&&(o.Qb(0,"tr"),o.Qb(1,"td"),o.Ac(2),o.Pb(),o.Qb(3,"td"),o.Ac(4),o.cc(5,"date"),o.Pb(),o.Qb(6,"td"),o.Ac(7),o.cc(8,"date"),o.Pb(),o.Qb(9,"td"),o.Ac(10),o.Pb(),o.Qb(11,"td"),o.Ac(12),o.Pb(),o.Qb(13,"td"),o.Ac(14),o.cc(15,"date"),o.Pb(),o.Pb()),2&t){const t=e.$implicit;o.zb(2),o.Bc(t.payment_id),o.zb(2),o.Bc(o.dc(5,6,t.created_at)),o.zb(3),o.Bc(o.dc(8,8,t.updated_at)),o.zb(3),o.Bc(t.status.data.name),o.zb(2),o.Bc(t.subscription.data.name),o.zb(2),o.Bc(o.dc(15,10,t.expires_at))}}function M(t,e){if(1&t&&(o.Qb(0,"table"),o.Qb(1,"thead"),o.Qb(2,"tr"),o.Qb(3,"th"),o.Ac(4,"Payment Id"),o.Pb(),o.Qb(5,"th"),o.Ac(6,"Created at"),o.Pb(),o.Qb(7,"th"),o.Ac(8,"Updated at"),o.Pb(),o.Qb(9,"th"),o.Ac(10,"Status"),o.Pb(),o.Qb(11,"th"),o.Ac(12,"Subscription"),o.Pb(),o.Qb(13,"th"),o.Ac(14,"Expired at"),o.Pb(),o.Pb(),o.Pb(),o.yc(15,O,16,12,"tr",51),o.Pb()),2&t){const t=o.bc();o.zb(15),o.hc("ngForOf",t.studentPayments)}}let I=(()=>{class t{constructor(t,e,n,i,s,a){this.dialogRef=t,this.dialogData=e,this.fb=n,this.studentsService=i,this.notificationService=s,this.subscriptionService=a,this.options={include:["category","questionAnswers"],page:1,perPage:15},this.showSubscriptionDropdown=!0,this.subscription=new h.a,this.enableExtend=!1,this.extendSubmitted=!1,this.extendSubscLoader=!1,this.extensionForm=this.fb.group({validity:["2",u.v.required],notes:["",u.v.required]})}ngOnInit(){this.student=this.dialogData.student.user.data,this.studentPayments=this.dialogData.student.payments.data,this.showSubscriptionDropdown=!this.studentPayments.filter(t=>"student_payment_status_pending"===t.status.data.value).length,this.initForm(),this.getSubscriptions(),this.subscription.add(this.form.get("is_active").valueChanges.subscribe(t=>{t||this.form.controls.subscription_id.setValue(null)}))}ngOnDestroy(){this.subscription.unsubscribe()}closePopup(){this.dialogRef.close()}populateForm(){this.form.invalid||this.studentsService.updateStudent(this.dialogData.student.id,{is_active:this.form.controls.is_active.value,locale:this.form.controls.locale.value,subscription_id:this.form.controls.subscription_id.value,user:{name:this.form.controls.name.value,email:this.form.controls.email.value,password:this.form.controls.password.value,password_confirmation:this.form.controls.password_confirmation.value}},{include:["user"]}).pipe(Object(p.a)()).subscribe(()=>{this.notificationService.success(),this.dialogRef.close()})}get e(){return this.extensionForm.controls}getSubscriptions(){this.subscriptionService.getSubscriptions().pipe(Object(p.a)()).subscribe(t=>this.subscriptions=t)}initForm(){this.form=this.fb.group({name:[this.student.name,u.v.required],email:[this.student.email,[u.v.required,u.v.email]],password:[null],password_confirmation:[null],subscription_id:[null],is_active:[this.dialogData.student.is_active],locale:["ru"]})}confirmExtend(){const t=this.extensionForm.value,e=this.studentPayments.find(t=>!!t.expires_at);if(t.payment_id=null==e?void 0:e.id,t.student_id=null==e?void 0:e.student_id,console.log(t,"payment:",e),!this.extensionForm.valid)return this.extendSubmitted=!0,void(this.extendSubscLoader=!1);this.extendSubmitted=!1,this.extendSubscLoader=!0,this.subscriptionService.extendSubscription(t).subscribe(t=>{this.extendSubscLoader=!1,this.notificationService.success("\u041f\u043e\u0434\u043f\u0438\u0441\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043f\u0440\u043e\u0434\u043b\u0435\u043d\u0430"),this.dialogRef.close()},t=>{this.extendSubscLoader=!1,this.notificationService.error("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a \u0441 \u0437\u0430\u043f\u0438\u0441\u044c\u044e \u043f\u043b\u0430\u0442\u0435\u0436\u0430")})}}return t.\u0275fac=function(e){return new(e||t)(o.Lb(d.d),o.Lb(d.a),o.Lb(u.d),o.Lb(l),o.Lb(m.a),o.Lb(g.a))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-student-form"]],decls:40,vars:6,consts:[[1,"text-center"],[3,"formGroup"],["appearance","fill",1,"example-full-width"],["matInput","","type","text","formControlName","name"],["matInput","","type","text","formControlName","email"],["matInput","","type","text","formControlName","password"],["matInput","","type","text","formControlName","password_confirmation"],[1,"mb-2"],["formControlName","is_active"],["appearance","fill",3,"hidden"],["formControlName","subscription_id"],[3,"value",4,"ngFor","ngForOf"],[1,"mt-1"],["type","submit",1,"extend-btn",3,"click"],["class","extension-container p-3 mt-2",4,"ngIf"],[1,"popup-actions","mt-3"],["type","button",1,"secondary",3,"click"],["type","submit",1,"primary",3,"click"],["class","text-center",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"extension-container","p-3","mt-2"],["class","font-weight-bold d-flex align-items-center justify-content-between",4,"ngIf"],[1,"extension-detail"],[1,"mb-0",3,"formGroup","ngSubmit"],[1,"row","g-3"],[1,"col-md-4"],[1,"form-group"],["for","purchase_validity",1,"mt-2"],["formControlName","validity",1,"form-control"],["value","1"],["value","2"],["value","3"],["value","5"],["value","7"],["value","10"],["value","14"],["value","30"],[1,"col-md-8"],[1,"d-flex","align-items-end","justify-content-between"],["for","notes",1,"mt-2"],["cols","80","rows","3","maxlength","100","formControlName","notes","placeholder","Why this action is required, please write a note",1,"form-control","p-2","pr-3","pl-3"],[1,"action-container","d-flex","justify-content-end","mt-4"],["type","submit",1,"btn-basic","btn-done","position-relative",3,"disabled"],["class","request-loader text-center",4,"ngIf"],[1,"font-weight-bold","d-flex","align-items-center","justify-content-between"],["src","assets/images/close.png","alt","","width","12",1,"float-right","pointer",3,"click"],["class","text-danger",4,"ngIf"],[1,"text-danger"],[1,"request-loader","text-center"],["src","assets/images/loader-dots.gif","alt",""],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(o.Qb(0,"h3",0),o.Ac(1,"Edit student"),o.Pb(),o.Qb(2,"form",1),o.Qb(3,"mat-form-field",2),o.Qb(4,"mat-label"),o.Ac(5,"Name"),o.Pb(),o.Mb(6,"input",3),o.Pb(),o.Qb(7,"mat-form-field",2),o.Qb(8,"mat-label"),o.Ac(9,"Email"),o.Pb(),o.Mb(10,"input",4),o.Pb(),o.Qb(11,"mat-form-field",2),o.Qb(12,"mat-label"),o.Ac(13,"Password"),o.Pb(),o.Mb(14,"input",5),o.Pb(),o.Qb(15,"mat-form-field",2),o.Qb(16,"mat-label"),o.Ac(17,"Confirm password"),o.Pb(),o.Mb(18,"input",6),o.Pb(),o.Qb(19,"div",7),o.Qb(20,"mat-slide-toggle",8),o.Ac(21,"Paid"),o.Pb(),o.Pb(),o.Qb(22,"mat-form-field",9),o.Qb(23,"mat-label"),o.Ac(24,"Select subscription"),o.Pb(),o.Qb(25,"mat-select",10),o.yc(26,y,2,2,"mat-option",11),o.Pb(),o.Pb(),o.Qb(27,"div",12),o.Qb(28,"button",13),o.Xb("click",(function(){return e.enableExtend=!0})),o.Ac(29,"Extend Subscription"),o.Pb(),o.Pb(),o.yc(30,C,37,5,"div",14),o.Qb(31,"div",15),o.Qb(32,"button",16),o.Xb("click",(function(){return e.closePopup()})),o.Ac(33,"Cancel"),o.Pb(),o.Qb(34,"button",17),o.Xb("click",(function(){return e.populateForm()})),o.Ac(35,"Confirm"),o.Pb(),o.Pb(),o.Pb(),o.Qb(36,"h4"),o.Ac(37,"Payments history"),o.Pb(),o.yc(38,z,2,0,"p",18),o.yc(39,M,16,1,"table",19)),2&t&&(o.zb(2),o.hc("formGroup",e.form),o.zb(20),o.hc("hidden",!(!e.dialogData.student.is_active&&e.showSubscriptionDropdown)),o.zb(4),o.hc("ngForOf",e.subscriptions),o.zb(4),o.hc("ngIf",e.enableExtend),o.zb(8),o.hc("ngIf",!(null!=e.studentPayments&&e.studentPayments.length)),o.zb(1),o.hc("ngIf",null==e.studentPayments?null:e.studentPayments.length))},directives:[u.x,u.p,u.h,f.c,f.f,P.a,u.b,u.o,u.g,v.a,Q.a,i.k,i.l,x.f,u.u,u.s,u.w,u.k],pipes:[i.e],styles:["form[_ngcontent-%COMP%]{max-width:500px;margin:auto auto 2rem}.extend-btn[_ngcontent-%COMP%]{padding:5px 10px!important;font-size:14px!important}.extension-container[_ngcontent-%COMP%]{border:1px solid #e4e4e4}.extension-container[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{font-size:14px!important}.extension-container[_ngcontent-%COMP%]   .request-loader[_ngcontent-%COMP%]{position:absolute;top:-2px;bottom:-2px;left:-2px;right:-2px;padding:3px}.extension-container[_ngcontent-%COMP%]   .request-loader[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:40px;height:20px}"]}),t})();var F=n("Kj3r"),k=n("M9IT");function D(t,e){1&t&&(o.Qb(0,"div",12),o.Mb(1,"img",13),o.Pb())}function E(t,e){if(1&t){const t=o.Rb();o.Qb(0,"tr"),o.Qb(1,"td"),o.Ac(2),o.Pb(),o.Qb(3,"td"),o.Qb(4,"div",7),o.Ac(5),o.yc(6,D,2,0,"div",8),o.Pb(),o.Pb(),o.Qb(7,"td"),o.Ac(8),o.Pb(),o.Qb(9,"td"),o.Qb(10,"span",9),o.Ac(11),o.Pb(),o.Pb(),o.Qb(12,"td"),o.Ac(13),o.cc(14,"date"),o.Pb(),o.Qb(15,"td"),o.Qb(16,"div",10),o.Ac(17),o.cc(18,"date"),o.Pb(),o.Pb(),o.Qb(19,"td",4),o.Qb(20,"i",11),o.Xb("click",(function(){o.pc(t);const n=e.$implicit;return o.bc().editStudent(n)})),o.Pb(),o.Pb(),o.Pb()}if(2&t){const t=e.$implicit,i=e.index,s=o.bc();var n;o.zb(2),o.Bc(i+1),o.zb(3),o.Cc(" ",null==t?null:t.user.data.name," "),o.zb(1),o.hc("ngIf",null==t?null:t.user.data.is_verified),o.zb(2),o.Bc(null==t?null:t.user.data.email),o.zb(2),o.hc("ngClass",null!=t&&t.is_active?"text-success":"text-warning"),o.zb(1),o.Bc(null!=t&&t.is_active?"Paid":"Free"),o.zb(2),o.Bc(o.dc(14,8,null==(n=s.getSubscriptionExpiry(null==t?null:t.payments.data))?null:n.expires_at)),o.zb(4),o.Bc(o.dc(18,10,null==t?null:t.user.data.created_at))}}const j=function(){return[5,10,25,100]};let L=(()=>{class t{constructor(t){this.dialog=t,this.changePagination=new o.n,this.searchFormControl=new u.e(""),this.changedPagination={page:1,perPage:15},this.subscription=new h.a}ngOnInit(){this.subscription=this.searchFormControl.valueChanges.pipe(Object(F.a)(1e3)).subscribe(t=>{this.changePagination.emit({pagination:this.changedPagination,search:t})})}ngOnDestroy(){this.subscription.unsubscribe()}editStudent(t){this.dialog.open(I,{width:"70rem",data:{student:t}}).afterClosed().pipe(Object(p.a)()).subscribe(()=>this.changePagination.emit(this.changedPagination))}changePage(t=null){t&&(this.changedPagination.page=t.pageIndex+1,this.changedPagination.perPage=t.pageSize),this.changePagination.emit({pagination:this.changedPagination,search:null})}getSubscriptionExpiry(t){return t.find(t=>!!t.expires_at)}}return t.\u0275fac=function(e){return new(e||t)(o.Lb(d.b))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-students-list"]],inputs:{students:"students",pagination:"pagination"},outputs:{changePagination:"changePagination"},decls:24,vars:6,consts:[[1,"overflow-auto"],[1,"d-flex"],[2,"margin-left","20px"],["type","text","placeholder","search...",3,"formControl"],[1,"text-right"],[4,"ngFor","ngForOf"],["aria-label","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443",3,"length","pageSize","pageSizeOptions","page"],[1,"d-flex","align-items-center"],["class","email-verified ms-1","title","Email is verified",4,"ngIf"],[3,"ngClass"],[1,"text-nowrap"],[1,"bx","bxs-pencil",3,"click"],["title","Email is verified",1,"email-verified","ms-1"],["alt","","src","assets/images/email-verified.png"]],template:function(t,e){1&t&&(o.Qb(0,"div",0),o.Qb(1,"table"),o.Qb(2,"thead"),o.Qb(3,"tr"),o.Qb(4,"th"),o.Ac(5,"No"),o.Pb(),o.Qb(6,"th"),o.Ac(7,"Full name"),o.Pb(),o.Qb(8,"th",1),o.Qb(9,"div"),o.Ac(10," eMail "),o.Pb(),o.Qb(11,"div",2),o.Mb(12,"input",3),o.Pb(),o.Pb(),o.Qb(13,"th"),o.Ac(14,"Status"),o.Pb(),o.Qb(15,"th"),o.Ac(16,"Expiry"),o.Pb(),o.Qb(17,"th"),o.Ac(18,"Created"),o.Pb(),o.Qb(19,"th",4),o.Ac(20,"Actions"),o.Pb(),o.Pb(),o.Pb(),o.Qb(21,"tbody"),o.yc(22,E,21,12,"tr",5),o.Pb(),o.Pb(),o.Qb(23,"mat-paginator",6),o.Xb("page",(function(t){return e.changePage(t)})),o.Pb(),o.Pb()),2&t&&(o.zb(12),o.hc("formControl",e.searchFormControl),o.zb(10),o.hc("ngForOf",e.students),o.zb(1),o.hc("length",null==e.pagination?null:e.pagination.length)("pageSize",null==e.pagination?null:e.pagination.pageSize)("pageSizeOptions",o.ic(5,j)))},directives:[u.b,u.o,u.f,i.k,k.a,i.l,i.j],pipes:[i.e],styles:["table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{width:40px}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(5){width:150px}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(6){width:100px}.email-verified[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px}"]}),t})();var q=n("aF9I");const N=[{path:"",component:(()=>{class t{constructor(t){this.studentsService=t,this.options={include:["user","payments.subscription","payments.status"],page:1,perPage:15}}ngOnInit(){this.getStudents()}getStudents(t=null){const e=[{field:"email",value:null==t?void 0:t.search}];this.options=Object.assign(Object.assign(Object.assign({},this.options),null==t?void 0:t.pagination),{filters:(null==t?void 0:t.search)?e:""}),this.students$=this.studentsService.getStudents(this.options).pipe(Object(a.a)(t=>(this.pagination={length:t.meta.pagination.total,pageSize:t.meta.pagination.per_page},t.data)))}}return t.\u0275fac=function(e){return new(e||t)(o.Lb(l))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-students"]],decls:7,vars:4,consts:[[1,"minus-header-footer-height"],[1,"container","py-50"],[1,"sub-title"],[3,"students","pagination","changePagination"]],template:function(t,e){1&t&&(o.Qb(0,"div",0),o.Qb(1,"div",1),o.Qb(2,"h2",2),o.Ac(3,"Students"),o.Pb(),o.Qb(4,"app-students-list",3),o.Xb("changePagination",(function(t){return e.getStudents(t)})),o.cc(5,"async"),o.Pb(),o.Pb(),o.Pb(),o.Mb(6,"app-footer")),2&t&&(o.zb(4),o.hc("students",o.dc(5,2,e.students$))("pagination",e.pagination))},directives:[L,q.a],pipes:[i.b],encapsulation:2}),t})()}];let B=(()=>{class t{}return t.\u0275mod=o.Jb({type:t}),t.\u0275inj=o.Ib({factory:function(e){return new(e||t)},imports:[[s.g.forChild(N)],s.g]}),t})();var X=n("PCNd");let R=(()=>{class t{}return t.\u0275mod=o.Jb({type:t}),t.\u0275inj=o.Ib({factory:function(e){return new(e||t)},imports:[[i.c,B,X.a]]}),t})()}}]);