(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{Smg6:function(t,e,n){"use strict";n.r(e),n.d(e,"StudentsModule",(function(){return R}));var i=n("ofXK"),s=n("tyNb"),o=n("lJxs"),a=n("fXoL"),c=n("lV75"),r=n("x6JD"),b=n("tk/3");let d=(()=>{class t{constructor(t){this.http=t}get url(){return c.a.baseUrl}getStudents(t){let e=this.url+"student";return t&&(e+=r.a.getOptionsQuery(t)),this.http.get(e)}updateStudent(t,e,n){let i=`${this.url}student/${t}`;return n&&(i+=r.a.getOptionsQuery(n)),this.http.put(i,e)}}return t.\u0275fac=function(e){return new(e||t)(a.Ub(b.b))},t.\u0275prov=a.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var l=n("0IaG"),u=n("3Pt+"),p=n("SxV6"),h=n("quSY"),g=n("9nlD"),m=n("VuJc"),f=n("kmnG"),P=n("qFsG"),x=n("1jcm"),v=n("d3UM"),Q=n("FKr1");function y(t,e){if(1&t&&(a.Qb(0,"mat-option",20),a.Ac(1),a.Pb()),2&t){const t=e.$implicit;a.hc("value",t.id),a.zb(1),a.Cc(" ",t.name," ")}}function S(t,e){if(1&t){const t=a.Rb();a.Qb(0,"h6",37),a.Ac(1,"Details "),a.Qb(2,"img",38),a.Xb("click",(function(){return a.pc(t),a.bc(2).enableExtend=!1})),a.Pb(),a.Pb()}}function w(t,e){if(1&t&&(a.Qb(0,"option",20),a.Ac(1),a.Pb()),2&t){const t=e.$implicit,n=a.bc(2);a.hc("value",t),a.zb(1),a.Bc(n.extensionOptions[t])}}function _(t,e){1&t&&(a.Qb(0,"div",40),a.Ac(1,"* Required "),a.Pb())}function A(t,e){if(1&t&&(a.Qb(0,"div"),a.yc(1,_,2,0,"div",39),a.Pb()),2&t){const t=a.bc(2);a.zb(1),a.hc("ngIf",t.extendSubmitted&&t.e.notes.errors.required)}}function O(t,e){1&t&&(a.Qb(0,"div",41),a.Mb(1,"img",42),a.Pb())}function C(t,e){if(1&t){const t=a.Rb();a.Qb(0,"div",21),a.yc(1,S,3,0,"h6",22),a.Qb(2,"div",23),a.Qb(3,"form",24),a.Xb("ngSubmit",(function(){return a.pc(t),a.bc().confirmExtend()})),a.Qb(4,"div",25),a.Qb(5,"div",26),a.Qb(6,"div",27),a.Qb(7,"label",28),a.Ac(8," Extend for "),a.Pb(),a.Qb(9,"select",29),a.yc(10,w,2,2,"option",11),a.Pb(),a.Pb(),a.Pb(),a.Qb(11,"div",30),a.Qb(12,"div",27),a.Qb(13,"div",31),a.Qb(14,"label",32),a.Ac(15," Notes "),a.Pb(),a.yc(16,A,2,1,"div",19),a.Pb(),a.Mb(17,"textarea",33),a.Pb(),a.Qb(18,"div",34),a.Qb(19,"button",35),a.yc(20,O,2,0,"div",36),a.Ac(21," Confirm "),a.Pb(),a.Pb(),a.Pb(),a.Pb(),a.Pb(),a.Pb(),a.Pb()}if(2&t){const t=a.bc();a.zb(1),a.hc("ngIf",t.enableExtend),a.zb(2),a.hc("formGroup",t.extensionForm),a.zb(7),a.hc("ngForOf",t.extensionKeys),a.zb(6),a.hc("ngIf",t.extendSubmitted&&t.e.notes.errors),a.zb(3),a.hc("disabled",t.extendSubscLoader),a.zb(1),a.hc("ngIf",t.extendSubscLoader)}}function z(t,e){1&t&&(a.Qb(0,"p",0),a.Ac(1,"EMPTY"),a.Pb())}function M(t,e){if(1&t&&(a.Qb(0,"tr"),a.Qb(1,"td"),a.Ac(2),a.Pb(),a.Qb(3,"td"),a.Ac(4),a.cc(5,"date"),a.Pb(),a.Qb(6,"td"),a.Ac(7),a.cc(8,"date"),a.Pb(),a.Qb(9,"td"),a.Ac(10),a.Pb(),a.Qb(11,"td"),a.Ac(12),a.Pb(),a.Qb(13,"td",44),a.Ac(14),a.Pb(),a.Qb(15,"td"),a.Ac(16),a.cc(17,"date"),a.Pb(),a.Pb()),2&t){const t=e.$implicit,n=a.bc(2);a.zb(2),a.Bc(t.payment_id),a.zb(2),a.Bc(a.dc(5,7,t.created_at)),a.zb(3),a.Bc(a.dc(8,9,t.updated_at)),a.zb(3),a.Bc(t.status.data.name),a.zb(2),a.Bc(t.subscription.data.name),a.zb(2),a.Bc(t.extend_for?n.extensionOptions[t.extend_for]:""),a.zb(2),a.Bc(a.dc(17,11,t.expires_at))}}function F(t,e){if(1&t&&(a.Qb(0,"table"),a.Qb(1,"thead"),a.Qb(2,"tr"),a.Qb(3,"th"),a.Ac(4,"Payment Id"),a.Pb(),a.Qb(5,"th"),a.Ac(6,"Created at"),a.Pb(),a.Qb(7,"th"),a.Ac(8,"Updated at"),a.Pb(),a.Qb(9,"th"),a.Ac(10,"Status"),a.Pb(),a.Qb(11,"th"),a.Ac(12,"Subscription"),a.Pb(),a.Qb(13,"th"),a.Ac(14,"Extended for"),a.Pb(),a.Qb(15,"th"),a.Ac(16,"Expired at"),a.Pb(),a.Pb(),a.Pb(),a.yc(17,M,18,13,"tr",43),a.Pb()),2&t){const t=a.bc();a.zb(17),a.hc("ngForOf",t.studentPayments)}}let I=(()=>{class t{constructor(t,e,n,i,s,o){this.dialogRef=t,this.dialogData=e,this.fb=n,this.studentsService=i,this.notificationService=s,this.subscriptionService=o,this.options={include:["category","questionAnswers"],page:1,perPage:15},this.showSubscriptionDropdown=!0,this.subscription=new h.a,this.enableExtend=!1,this.extendSubmitted=!1,this.extendSubscLoader=!1,this.extensionOptions={1:"1 Day",2:"2 Days",3:"3 Days",5:"5 Days",7:"1 Week",10:"10 Days",14:"2 Weeks",30:"1 Month"},this.extensionKeys=Object.keys(this.extensionOptions),this.extensionForm=this.fb.group({validity:["2",u.v.required],notes:["",u.v.required]})}ngOnInit(){this.student=this.dialogData.student.user.data,this.studentPayments=this.dialogData.student.payments.data,this.showSubscriptionDropdown=!this.studentPayments.filter(t=>"student_payment_status_pending"===t.status.data.value).length,this.initForm(),this.getSubscriptions(),this.subscription.add(this.form.get("is_active").valueChanges.subscribe(t=>{t||this.form.controls.subscription_id.setValue(null)}))}ngOnDestroy(){this.subscription.unsubscribe()}closePopup(){this.dialogRef.close()}populateForm(){this.form.invalid||this.studentsService.updateStudent(this.dialogData.student.id,{is_active:this.form.controls.is_active.value,locale:this.form.controls.locale.value,subscription_id:this.form.controls.subscription_id.value,user:{name:this.form.controls.name.value,email:this.form.controls.email.value,password:this.form.controls.password.value,password_confirmation:this.form.controls.password_confirmation.value}},{include:["user"]}).pipe(Object(p.a)()).subscribe(()=>{this.notificationService.success(),this.dialogRef.close()})}get e(){return this.extensionForm.controls}getSubscriptions(){this.subscriptionService.getSubscriptions().pipe(Object(p.a)()).subscribe(t=>this.subscriptions=t)}initForm(){this.form=this.fb.group({name:[this.student.name,u.v.required],email:[this.student.email,[u.v.required,u.v.email]],password:[null],password_confirmation:[null],subscription_id:[null],is_active:[this.dialogData.student.is_active],locale:["ru"]})}confirmExtend(){const t=this.extensionForm.value,e=this.studentPayments.find(t=>!!t.expires_at);if(t.payment_id=null==e?void 0:e.id,t.student_id=null==e?void 0:e.student_id,console.log(t,"payment:",e),!this.extensionForm.valid)return this.extendSubmitted=!0,void(this.extendSubscLoader=!1);this.extendSubmitted=!1,this.extendSubscLoader=!0,this.subscriptionService.extendSubscription(t).subscribe(t=>{this.extendSubscLoader=!1,this.notificationService.success("\u041f\u043e\u0434\u043f\u0438\u0441\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043f\u0440\u043e\u0434\u043b\u0435\u043d\u0430"),this.dialogRef.close()},t=>{this.extendSubscLoader=!1,this.notificationService.error("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a \u0441 \u0437\u0430\u043f\u0438\u0441\u044c\u044e \u043f\u043b\u0430\u0442\u0435\u0436\u0430")})}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(l.d),a.Lb(l.a),a.Lb(u.d),a.Lb(d),a.Lb(g.a),a.Lb(m.a))},t.\u0275cmp=a.Fb({type:t,selectors:[["app-student-form"]],decls:40,vars:6,consts:[[1,"text-center"],[3,"formGroup"],["appearance","fill",1,"example-full-width"],["matInput","","type","text","formControlName","name"],["matInput","","type","text","formControlName","email"],["matInput","","type","text","formControlName","password"],["matInput","","type","text","formControlName","password_confirmation"],[1,"mb-2"],["formControlName","is_active"],["appearance","fill",3,"hidden"],["formControlName","subscription_id"],[3,"value",4,"ngFor","ngForOf"],[1,"mt-1"],["type","submit",1,"extend-btn",3,"click"],["class","extension-container p-3 mt-2",4,"ngIf"],[1,"popup-actions","mt-3"],["type","button",1,"secondary",3,"click"],["type","submit",1,"primary",3,"click"],["class","text-center",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"extension-container","p-3","mt-2"],["class","font-weight-bold d-flex align-items-center justify-content-between",4,"ngIf"],[1,"extension-detail"],[1,"mb-0",3,"formGroup","ngSubmit"],[1,"row","g-3"],[1,"col-md-4"],[1,"form-group"],["for","purchase_validity",1,"mt-2"],["formControlName","validity",1,"form-control"],[1,"col-md-8"],[1,"d-flex","align-items-end","justify-content-between"],["for","notes",1,"mt-2"],["cols","80","rows","3","maxlength","100","formControlName","notes","placeholder","Why this action is required, please write a note",1,"form-control","p-2","pr-3","pl-3"],[1,"action-container","d-flex","justify-content-end","mt-4"],["type","submit",1,"btn-basic","btn-done","position-relative",3,"disabled"],["class","request-loader text-center",4,"ngIf"],[1,"font-weight-bold","d-flex","align-items-center","justify-content-between"],["src","assets/images/close.png","alt","","width","12",1,"float-right","pointer",3,"click"],["class","text-danger",4,"ngIf"],[1,"text-danger"],[1,"request-loader","text-center"],["src","assets/images/loader-dots.gif","alt",""],[4,"ngFor","ngForOf"],[1,"text-warning"]],template:function(t,e){1&t&&(a.Qb(0,"h3",0),a.Ac(1,"Edit student"),a.Pb(),a.Qb(2,"form",1),a.Qb(3,"mat-form-field",2),a.Qb(4,"mat-label"),a.Ac(5,"Name"),a.Pb(),a.Mb(6,"input",3),a.Pb(),a.Qb(7,"mat-form-field",2),a.Qb(8,"mat-label"),a.Ac(9,"Email"),a.Pb(),a.Mb(10,"input",4),a.Pb(),a.Qb(11,"mat-form-field",2),a.Qb(12,"mat-label"),a.Ac(13,"Password"),a.Pb(),a.Mb(14,"input",5),a.Pb(),a.Qb(15,"mat-form-field",2),a.Qb(16,"mat-label"),a.Ac(17,"Confirm password"),a.Pb(),a.Mb(18,"input",6),a.Pb(),a.Qb(19,"div",7),a.Qb(20,"mat-slide-toggle",8),a.Ac(21,"Paid"),a.Pb(),a.Pb(),a.Qb(22,"mat-form-field",9),a.Qb(23,"mat-label"),a.Ac(24,"Select subscription"),a.Pb(),a.Qb(25,"mat-select",10),a.yc(26,y,2,2,"mat-option",11),a.Pb(),a.Pb(),a.Qb(27,"div",12),a.Qb(28,"button",13),a.Xb("click",(function(){return e.enableExtend=!0})),a.Ac(29,"Extend Subscription"),a.Pb(),a.Pb(),a.yc(30,C,22,6,"div",14),a.Qb(31,"div",15),a.Qb(32,"button",16),a.Xb("click",(function(){return e.closePopup()})),a.Ac(33,"Cancel"),a.Pb(),a.Qb(34,"button",17),a.Xb("click",(function(){return e.populateForm()})),a.Ac(35,"Confirm"),a.Pb(),a.Pb(),a.Pb(),a.Qb(36,"h4"),a.Ac(37,"Payments history"),a.Pb(),a.yc(38,z,2,0,"p",18),a.yc(39,F,18,1,"table",19)),2&t&&(a.zb(2),a.hc("formGroup",e.form),a.zb(20),a.hc("hidden",!(!e.dialogData.student.is_active&&e.showSubscriptionDropdown)),a.zb(4),a.hc("ngForOf",e.subscriptions),a.zb(4),a.hc("ngIf",e.enableExtend),a.zb(8),a.hc("ngIf",!(null!=e.studentPayments&&e.studentPayments.length)),a.zb(1),a.hc("ngIf",null==e.studentPayments?null:e.studentPayments.length))},directives:[u.x,u.p,u.h,f.c,f.f,P.a,u.b,u.o,u.g,x.a,v.a,i.k,i.l,Q.f,u.u,u.k,u.s,u.w],pipes:[i.e],styles:["form[_ngcontent-%COMP%]{max-width:500px;margin:auto auto 2rem}.extend-btn[_ngcontent-%COMP%]{padding:5px 10px!important;font-size:14px!important}.extension-container[_ngcontent-%COMP%]{border:1px solid #e4e4e4}.extension-container[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{font-size:14px!important}.extension-container[_ngcontent-%COMP%]   .request-loader[_ngcontent-%COMP%]{position:absolute;top:-2px;bottom:-2px;left:-2px;right:-2px;padding:3px}.extension-container[_ngcontent-%COMP%]   .request-loader[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:40px;height:20px}"]}),t})();var k=n("Kj3r"),D=n("M9IT");function E(t,e){1&t&&(a.Qb(0,"div",12),a.Mb(1,"img",13),a.Pb())}function j(t,e){if(1&t){const t=a.Rb();a.Qb(0,"tr"),a.Qb(1,"td"),a.Ac(2),a.Pb(),a.Qb(3,"td"),a.Qb(4,"div",7),a.Ac(5),a.yc(6,E,2,0,"div",8),a.Pb(),a.Pb(),a.Qb(7,"td"),a.Ac(8),a.Pb(),a.Qb(9,"td"),a.Qb(10,"span",9),a.Ac(11),a.Pb(),a.Pb(),a.Qb(12,"td"),a.Ac(13),a.cc(14,"date"),a.Pb(),a.Qb(15,"td"),a.Qb(16,"div",10),a.Ac(17),a.cc(18,"date"),a.Pb(),a.Pb(),a.Qb(19,"td",4),a.Qb(20,"i",11),a.Xb("click",(function(){a.pc(t);const n=e.$implicit;return a.bc().editStudent(n)})),a.Pb(),a.Pb(),a.Pb()}if(2&t){const t=e.$implicit,i=e.index,s=a.bc();var n;a.zb(2),a.Bc(i+1),a.zb(3),a.Cc(" ",null==t?null:t.user.data.name," "),a.zb(1),a.hc("ngIf",null==t?null:t.user.data.is_verified),a.zb(2),a.Bc(null==t?null:t.user.data.email),a.zb(2),a.hc("ngClass",null!=t&&t.is_active?"text-success":"text-warning"),a.zb(1),a.Bc(null!=t&&t.is_active?"Paid":"Free"),a.zb(2),a.Bc(a.dc(14,8,null==(n=s.getSubscriptionExpiry(null==t?null:t.payments.data))?null:n.expires_at)),a.zb(4),a.Bc(a.dc(18,10,null==t?null:t.user.data.created_at))}}const L=function(){return[5,10,25,100]};let q=(()=>{class t{constructor(t){this.dialog=t,this.changePagination=new a.n,this.searchFormControl=new u.e(""),this.changedPagination={page:1,perPage:15},this.subscription=new h.a}ngOnInit(){this.subscription=this.searchFormControl.valueChanges.pipe(Object(k.a)(1e3)).subscribe(t=>{this.changePagination.emit({pagination:this.changedPagination,search:t})})}ngOnDestroy(){this.subscription.unsubscribe()}editStudent(t){this.dialog.open(I,{width:"70rem",data:{student:t}}).afterClosed().pipe(Object(p.a)()).subscribe(()=>this.changePagination.emit(this.changedPagination))}changePage(t=null){t&&(this.changedPagination.page=t.pageIndex+1,this.changedPagination.perPage=t.pageSize),this.changePagination.emit({pagination:this.changedPagination,search:null})}getSubscriptionExpiry(t){return t.find(t=>!!t.expires_at)}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(l.b))},t.\u0275cmp=a.Fb({type:t,selectors:[["app-students-list"]],inputs:{students:"students",pagination:"pagination"},outputs:{changePagination:"changePagination"},decls:24,vars:6,consts:[[1,"overflow-auto"],[1,"d-flex"],[2,"margin-left","20px"],["type","text","placeholder","search...",3,"formControl"],[1,"text-right"],[4,"ngFor","ngForOf"],["aria-label","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443",3,"length","pageSize","pageSizeOptions","page"],[1,"d-flex","align-items-center"],["class","email-verified ms-1","title","Email is verified",4,"ngIf"],[3,"ngClass"],[1,"text-nowrap"],[1,"bx","bxs-pencil",3,"click"],["title","Email is verified",1,"email-verified","ms-1"],["alt","","src","assets/images/email-verified.png"]],template:function(t,e){1&t&&(a.Qb(0,"div",0),a.Qb(1,"table"),a.Qb(2,"thead"),a.Qb(3,"tr"),a.Qb(4,"th"),a.Ac(5,"No"),a.Pb(),a.Qb(6,"th"),a.Ac(7,"Full name"),a.Pb(),a.Qb(8,"th",1),a.Qb(9,"div"),a.Ac(10," eMail "),a.Pb(),a.Qb(11,"div",2),a.Mb(12,"input",3),a.Pb(),a.Pb(),a.Qb(13,"th"),a.Ac(14,"Status"),a.Pb(),a.Qb(15,"th"),a.Ac(16,"Expiry"),a.Pb(),a.Qb(17,"th"),a.Ac(18,"Created"),a.Pb(),a.Qb(19,"th",4),a.Ac(20,"Actions"),a.Pb(),a.Pb(),a.Pb(),a.Qb(21,"tbody"),a.yc(22,j,21,12,"tr",5),a.Pb(),a.Pb(),a.Qb(23,"mat-paginator",6),a.Xb("page",(function(t){return e.changePage(t)})),a.Pb(),a.Pb()),2&t&&(a.zb(12),a.hc("formControl",e.searchFormControl),a.zb(10),a.hc("ngForOf",e.students),a.zb(1),a.hc("length",null==e.pagination?null:e.pagination.length)("pageSize",null==e.pagination?null:e.pagination.pageSize)("pageSizeOptions",a.ic(5,L)))},directives:[u.b,u.o,u.f,i.k,D.a,i.l,i.j],pipes:[i.e],styles:["table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{width:40px}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(5){width:150px}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(6){width:100px}.email-verified[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px}"]}),t})();var B=n("aF9I");const N=[{path:"",component:(()=>{class t{constructor(t){this.studentsService=t,this.options={include:["user","payments.subscription","payments.status"],page:1,perPage:15}}ngOnInit(){this.getStudents()}getStudents(t=null){const e=[{field:"email",value:null==t?void 0:t.search}];this.options=Object.assign(Object.assign(Object.assign({},this.options),null==t?void 0:t.pagination),{filters:(null==t?void 0:t.search)?e:""}),this.students$=this.studentsService.getStudents(this.options).pipe(Object(o.a)(t=>(this.pagination={length:t.meta.pagination.total,pageSize:t.meta.pagination.per_page},t.data)))}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(d))},t.\u0275cmp=a.Fb({type:t,selectors:[["app-students"]],decls:7,vars:4,consts:[[1,"minus-header-footer-height"],[1,"container","py-50"],[1,"sub-title"],[3,"students","pagination","changePagination"]],template:function(t,e){1&t&&(a.Qb(0,"div",0),a.Qb(1,"div",1),a.Qb(2,"h2",2),a.Ac(3,"Students"),a.Pb(),a.Qb(4,"app-students-list",3),a.Xb("changePagination",(function(t){return e.getStudents(t)})),a.cc(5,"async"),a.Pb(),a.Pb(),a.Pb(),a.Mb(6,"app-footer")),2&t&&(a.zb(4),a.hc("students",a.dc(5,2,e.students$))("pagination",e.pagination))},directives:[q,B.a],pipes:[i.b],encapsulation:2}),t})()}];let X=(()=>{class t{}return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},imports:[[s.g.forChild(N)],s.g]}),t})();var $=n("PCNd");let R=(()=>{class t{}return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},imports:[[i.c,X,$.a]]}),t})()}}]);